{"version":3,"sources":["assets/audio sync /^/.//effect/-.*/.mp3$","assets/audio/effect-1024.mp3","assets/audio/effect-128.mp3","assets/audio/effect-16.mp3","assets/audio/effect-2.mp3","assets/audio/effect-2048.mp3","assets/audio/effect-256.mp3","assets/audio/effect-32.mp3","assets/audio/effect-4.mp3","assets/audio/effect-4096.mp3","assets/audio/effect-512.mp3","assets/audio/effect-64.mp3","assets/audio/effect-8.mp3","lib/Game2048.ts","lib/SoundManager.ts","lib/StateManager.ts","lib/VibratorManager.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","Direction","Game2048Tile","i","j","value","key","overlaid","this","Math","random","Date","getTime","toString","floor","Number","MAX_SAFE_INTEGER","Game2048","options","_tiles","Map","_gameOver","_options","_won","state","forEach","index","newTile","pow","set","generateTile","onStateChanged","_getState","onUpdate","Array","from","values","validPos","Set","add","delete","validPosArray","pos","length","judge","flag","tilesArray","_getTopTiles","direction","base","diff","Up","Right","Down","Left","toDelete","movedFlag","winFlag","scoreAdded","maxTileMerged","b","currentTile","targetPosIndex","d","tile","max","targetPos","gameOverFlag","onScoreAdd","onMaxMerge","onGameOver","on2048","result","log2","toDeleteKey","push","SoundManager","_soundSources","_count","tasks","sound","Howl","src","require","Promise","reject","once","on","onPlay","onEnded","all","then","onLoad","catch","onError","source","get","playing","play","StateManager","_timer","localStorage","raw","getItem","JSON","parse","best","game","score","clearTimeout","window","setTimeout","_realSetState","setItem","stringify","VibratorManager","_available","navigator","vibrate","n","pat","getNumber","toPrecision","Tile","pulse","props","_unmounted","prevProps","prevState","setState","className","words","min","getText","React","Component","App","tiles","logoPulse","messageVisible","message","containerRef","hammer","soundManager","vibratorManager","stateManager","_newGame","event","currentTarget","blur","_createGame","gtag","_tryResumeGame","getState","assign","firstUpdate","vibrateShort","gameOver","vibrateLong","newState","_moveK","ctrlKey","altKey","metaKey","toLowerCase","gameMessage","document","querySelector","click","preventDefault","move","_moveG","Hammer","DIRECTION_UP","DIRECTION_RIGHT","DIRECTION_DOWN","DIRECTION_LEFT","createRef","addEventListener","Manager","current","recognizers","Pan","removeEventListener","off","Fragment","undefined","aria-label","onClick","ref","role","href","target","rel","data-size","data-show-count","data-icon","viewBox","aria-hidden","getFullYear","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","onSuccess","error","setDocHeight","documentElement","style","setProperty","innerHeight","ReactDOM","render","StrictMode","getElementById","URL","process","origin","fetch","headers","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.daba5ba3.chunk.js","sourcesContent":["var map = {\n\t\"./effect-1024.mp3\": 19,\n\t\"./effect-128.mp3\": 20,\n\t\"./effect-16.mp3\": 21,\n\t\"./effect-2.mp3\": 22,\n\t\"./effect-2048.mp3\": 23,\n\t\"./effect-256.mp3\": 24,\n\t\"./effect-32.mp3\": 25,\n\t\"./effect-4.mp3\": 26,\n\t\"./effect-4096.mp3\": 27,\n\t\"./effect-512.mp3\": 28,\n\t\"./effect-64.mp3\": 29,\n\t\"./effect-8.mp3\": 30\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 18;","module.exports = __webpack_public_path__ + \"static/media/effect-1024.a0467517.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-128.7d9cd61e.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-16.0953911a.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-2.4853522c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-2048.cbd9f9d4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-256.7e6f0524.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-32.a702a9c8.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-4.2c69c693.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-4096.e0a903fa.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-512.15364d6c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-64.ef7ffd6a.mp3\";","module.exports = __webpack_public_path__ + \"static/media/effect-8.757f5d76.mp3\";","export class Game2048Tile {\n  i: number;\n  j: number;\n  value: number;\n  key: string;\n  overlaid: boolean;\n\n  constructor(i: number, j: number, value: number | null = null) {\n    this.i = i;\n    this.j = j;\n    this.value = value != null ? value : (Math.random() < 0.9 ? 2 : 4);\n    this.key = new Date().getTime().toString(36) +\n      Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(36);\n    this.overlaid = false;\n  }\n}\n\nexport enum Direction {Up, Right, Down, Left}\n\ninterface Game2048Options {\n  onUpdate?: (tiles: Game2048Tile[]) => void;\n  onScoreAdd?: (value: number) => void;\n  onMaxMerge?: (value: number) => void;\n  onGameOver?: () => void;\n  onStateChanged?: (state: number[] | null) => void;\n  on2048?: (gameOver?: boolean) => void;\n  state?: number[] | null,\n}\n\nexport default class Game2048 {\n  protected _tiles = new Map<string, Game2048Tile>();\n  protected _gameOver = false;\n  protected _options: Game2048Options;\n  protected _won = false;\n\n  constructor(options: Game2048Options) {\n    this._options = options;\n    if (this._options.state) {\n      this._options.state.forEach((value, index) => {\n        if (value > 0) {\n          const newTile = new Game2048Tile(Math.floor(index / 4), index % 4, Math.pow(2, value));\n          this._tiles.set(newTile.key, newTile);\n          if (newTile.value >= 2048) {\n            this._won = true;\n          }\n        }\n      });\n    } else {\n      this.generateTile();\n      this.generateTile();\n      if (this._options.onStateChanged != null) {\n        this._options.onStateChanged(this._getState());\n      }\n    }\n    if (this._options.onUpdate != null) {\n      this._options.onUpdate(Array.from(this._tiles.values()));\n    }\n  }\n\n  generateTile(): boolean {\n    const validPos = new Set<number>();\n    for (let i = 0; i < 16; i++) {\n      validPos.add(i);\n    }\n    this._tiles.forEach(({ i, j }) => {\n      validPos.delete(i * 4 + j);\n    });\n    const validPosArray = Array.from(validPos);\n    const pos = validPosArray[Math.floor(Math.random() * validPosArray.length)];\n    const i = Math.floor(pos / 4), j = pos % 4;\n    const newTile = new Game2048Tile(i, j);\n    this._tiles.set(newTile.key, newTile);\n    if (validPosArray.length === 1) {\n      return this.judge();\n    }\n    return false;\n  }\n\n  judge(): boolean {\n    let flag = true;\n    const { tilesArray } = this._getTopTiles();\n    for (let i = 0; flag && i < 4; i++) {\n      for (let j = 0; flag && j < 4; j++) {\n        if (tilesArray[i * 4 + j] == null ||\n          ((i % 4 < 3) && (tilesArray[(i + 1) * 4 + j] == null ||\n            // @ts-ignore\n            tilesArray[i * 4 + j].value === tilesArray[(i + 1) * 4 + j].value)) ||\n          ((j % 4 < 3) && (tilesArray[i * 4 + j + 1] == null ||\n            // @ts-ignore\n            tilesArray[i * 4 + j].value === tilesArray[i * 4 + j + 1].value))) {\n          flag = false;\n        }\n      }\n    }\n    return this._gameOver = flag;\n  }\n\n  move(direction: Direction): void {\n    if (this._gameOver) {\n      return;\n    }\n    let base: number[], diff: number[];\n    switch (direction) {\n      case Direction.Up:\n        base = [0, 4, 8, 12];\n        diff = [0, 1, 2, 3];\n        break;\n      case Direction.Right:\n        base = [12, 13, 14, 15];\n        diff = [0, -4, -8, -12];\n        break;\n      case Direction.Down:\n        base = [3, 7, 11, 15];\n        diff = [0, -1, -2, -3];\n        break;\n      case Direction.Left:\n        base = [0, 1, 2, 3];\n        diff = [0, 4, 8, 12];\n        break;\n    }\n    const { tilesArray, toDelete } = this._getTopTiles();\n    toDelete.forEach((key) => {\n      this._tiles.delete(key);\n    });\n    let movedFlag = false;\n    let winFlag = false;\n    let scoreAdded = 0;\n    let maxTileMerged = 0;\n    base.forEach((b) => {\n      let currentTile: Game2048Tile | null = null;\n      let targetPosIndex = 0;\n      diff.forEach((d) => {\n        const tile = tilesArray[b + d];\n        if (tile != null) {\n          if (currentTile != null && tile.value === currentTile.value) {\n            tile.overlaid = true;\n            currentTile.value = tile.value * 2;\n            if (currentTile.value === 2048) {\n              if (!this._won) {\n                this._won = true;\n                winFlag = true;\n              }\n            }\n            tile.i = currentTile.i;\n            tile.j = currentTile.j;\n            scoreAdded += currentTile.value;\n            movedFlag = true;\n            maxTileMerged = Math.max(maxTileMerged, currentTile.value);\n            currentTile = null;\n          } else {\n            const targetPos = b + diff[targetPosIndex];\n            if (tile.i * 4 + tile.j !== targetPos) {\n              tile.i = Math.floor(targetPos / 4);\n              tile.j = targetPos % 4;\n              movedFlag = true;\n            }\n            currentTile = tile;\n            targetPosIndex++;\n          }\n        }\n      });\n    });\n    let gameOverFlag = false;\n    if (movedFlag) {\n      gameOverFlag = this.generateTile();\n      if (this._options.onUpdate != null) {\n        this._options.onUpdate(Array.from(this._tiles.values()));\n      }\n    }\n    if (scoreAdded && this._options.onScoreAdd != null) {\n      this._options.onScoreAdd(scoreAdded);\n    }\n    if (maxTileMerged && this._options.onMaxMerge) {\n      this._options.onMaxMerge(maxTileMerged);\n    }\n    if (gameOverFlag) {\n      if (this._options.onGameOver && !winFlag) {\n        this._options.onGameOver();\n      }\n    }\n    if (winFlag) {\n      if (this._options.on2048) {\n        this._options.on2048(gameOverFlag);\n      }\n    }\n    if (movedFlag && this._options.onStateChanged != null) {\n      this._options.onStateChanged(this._getState());\n    }\n  }\n\n  protected _getState(): number[] | null {\n    if (!this._gameOver) {\n      const result: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n      this._tiles.forEach((tile) => {\n        const { i, j, value, overlaid } = tile;\n        if (!overlaid) {\n          result[i * 4 + j] = Math.log2(value);\n        }\n      });\n      return result;\n    } else {\n      return null;\n    }\n  }\n\n  protected _getTopTiles(): { tilesArray: (Game2048Tile | null)[], toDelete: string[] } {\n    const result: (Game2048Tile | null)[] =\n      [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null];\n    const toDeleteKey: string[] = [];\n    this._tiles.forEach((tile) => {\n      const { i, j, key, overlaid } = tile;\n      if (!overlaid) {\n        result[i * 4 + j] = tile;\n      } else {\n        toDeleteKey.push(key);\n      }\n    });\n    return {\n      tilesArray: result,\n      toDelete: toDeleteKey,\n    };\n  }\n};\n","import { Howl } from 'howler';\n\n\ninterface SoundManagerOptions {\n  onLoad?: () => void,\n  onError?: () => void,\n  onPlay?: () => void,\n  onEnded?: () => void,\n}\n\nexport default class SoundManager {\n  protected _soundSources = new Map<number, Howl>();\n  protected _options: SoundManagerOptions;\n  protected _count = 0;\n\n  constructor(options: SoundManagerOptions) {\n    this._options = options;\n    const tasks = [];\n    for (let i = 2; i <= 4096; i *= 2) {\n      const sound: Howl = new Howl({\n        src: [require(`../assets/audio/effect-${i}.mp3`)],\n      });\n      tasks.push(new Promise((resolve, reject) => {\n        sound.once('load', () => {\n          this._soundSources.set(i, sound);\n          resolve();\n        });\n        sound.once('loaderror', () => {\n          this._soundSources.set(i, sound);\n          reject();\n        });\n        sound.on('play', () => {\n          this._count++;\n          if (this._options.onPlay != null) {\n            this._options.onPlay();\n          }\n        });\n        sound.on('end', () => {\n          this._count--;\n          if (this._count === 0 && this._options.onEnded) {\n            this._options.onEnded();\n          }\n        });\n      }));\n    }\n    Promise.all(tasks).then(() => {\n      if (this._options.onLoad != null) {\n        this._options.onLoad();\n      }\n    }).catch(() => {\n      if (this._options.onError != null) {\n        this._options.onError();\n      }\n    });\n  }\n\n  play(value: number) {\n    const source = this._soundSources.get(value);\n    if (source != null && !source.playing()) {\n      source.play();\n    }\n  }\n}\n","interface State {\n  best: number,\n  game: number[] | null,\n  score: number,\n}\n\nexport default class StateManager {\n  protected _timer: number | null;\n\n  constructor() {\n    this._timer = null;\n  }\n\n  getState(): State {\n    if (localStorage != null) {\n      const raw = localStorage.getItem('gameJntm/state');\n      if (raw != null) {\n        return JSON.parse(raw);\n      }\n    }\n    return {\n      best: 0,\n      game: null,\n      score: 0,\n    };\n  }\n\n  setState(state: State): void {\n    if (this._timer != null) {\n      clearTimeout(this._timer);\n    }\n    this._timer = window.setTimeout(() => this._realSetState(state), 300);\n  }\n\n  protected _realSetState(state: State): void {\n    this._timer = null;\n    if (localStorage != null) {\n      localStorage.setItem('gameJntm/state', JSON.stringify(state));\n    }\n  }\n}\n","export default class VibratorManager {\n  protected _available = false;\n\n  constructor() {\n    // @ts-ignore\n    if (navigator.vibrate) {\n      this._available = true;\n    }\n  }\n\n  vibrateShort(n: number) {\n    if (this._available) {\n      const pat = [];\n      for (let i = 0; i < n * 2 - 1; i++) {\n        pat.push(i % 2 === 0 ? 5 : 5);\n      }\n      navigator.vibrate(pat);\n    }\n  }\n\n  vibrateLong() {\n    if (this._available) {\n      navigator.vibrate(400);\n    }\n  }\n}\n","import Hammer from 'hammerjs';\nimport React from 'react';\nimport GitHubButton from 'react-github-btn';\nimport './App.scss';\nimport Game2048, { Direction, Game2048Tile } from './lib/Game2048';\nimport SoundManager from './lib/SoundManager';\nimport StateManager from './lib/StateManager';\nimport VibratorManager from './lib/VibratorManager';\n\n\nconst getText = (value: number) => {\n  const words = [\n    '大家好', '我是', '练习时长', '两年半的', // 2, 4, 8, 16\n    '个人练习生', 'CXK', '喜欢', '唱', // 32, 64, 128, 256\n    '跳', 'RAP', '篮球', 'MUSIC', // 512, 1024, 2048, 4096\n    '鸡', '你', '太', '美', // 8192, 16384, 32768, 65536\n    'BABY', 'OH~', // 131072, undefined\n  ];\n  return words[Math.min(Math.log2(value), words.length) - 1];\n};\n\nconst getNumber: (value: number) => string = (value: number) => {\n  if (value >= 100000000) {\n    return value.toPrecision(2);\n  } else if (value >= 1000000) {\n    return `${(value / 1000000).toPrecision(3)}M`;\n  } else if (value >= 100000) {\n    return `${(value / 1000).toPrecision(3)}K`;\n  } else {\n    return value.toString();\n  }\n};\n\ninterface TileProps {\n  i: number,\n  j: number,\n  value: number,\n  overlaid: boolean\n}\n\nclass Tile extends React.Component<TileProps> {\n  state = {\n    pulse: false as boolean,\n    value: this.props.value as number,\n  };\n  protected _unmounted = false;\n\n  componentDidUpdate(prevProps: Readonly<TileProps>, prevState: Readonly<{ pulse: boolean, value: number }>) {\n    if (prevProps.value !== this.props.value) {\n      this.setState({\n        pulse: false,\n      }, () => setTimeout(() => !this._unmounted && this.setState({\n        pulse: true,\n        value: this.props.value,\n      }), 50));\n    }\n  }\n\n  componentWillUnmount() {\n    this._unmounted = true;\n  }\n\n  render() {\n    const { i, j, overlaid } = this.props;\n    const { value } = this.state;\n    let className = `game-tile pos-i-${i} pos-j-${j} tile-${value}`;\n    overlaid && (className += ' tile-overlaid');\n    this.state.pulse && (className += ' tile-pulse');\n    return (\n      <span className={className}><sup className=\"value\">{value}</sup>{getText(value)}</span>\n    );\n  }\n}\n\nclass App extends React.Component {\n  state = {\n    tiles: [] as Game2048Tile[],\n    score: 0 as number,\n    best: 0 as number,\n    scoreAdded: 0 as number,\n    logoPulse: false,\n    messageVisible: true as boolean,\n    message: 'start' as 'start' | 'win' | 'win-game-over' | 'game-over',\n  };\n\n  protected containerRef: React.RefObject<HTMLDivElement>;\n  protected game: Game2048 | null;\n  protected hammer: HammerManager | null;\n  protected soundManager: SoundManager | null;\n  protected vibratorManager: VibratorManager;\n  protected stateManager: StateManager;\n\n  constructor(props: Readonly<{}>) {\n    super(props);\n    this.containerRef = React.createRef();\n    this.game = null;\n    this.hammer = null;\n    this.soundManager = null;\n    this.vibratorManager = new VibratorManager();\n    this.stateManager = new StateManager();\n  }\n\n  componentDidMount(): void {\n    window.addEventListener('keydown', this._moveK);\n    this.hammer = new Hammer.Manager(this.containerRef.current as EventTarget, {\n      recognizers: [[Hammer.Pan]],\n    });\n    this.hammer.on('panstart', (event) => this._moveG(event.direction));\n    this.soundManager = new SoundManager({\n      onPlay: () => {\n        this.setState({\n          logoPulse: true,\n        });\n      },\n      onEnded: () => {\n        this.setState({\n          logoPulse: false,\n        });\n      },\n    });\n    this._tryResumeGame();\n  }\n\n  componentWillUnmount(): void {\n    window.removeEventListener('keydown', this._moveK);\n    if (this.hammer) {\n      this.hammer.off('panstart');\n    }\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className=\"app\">\n          <header className=\"header\">\n            <div className=\"scoreboard\">\n              <div className=\"title\">最高分</div>\n              <div>{getNumber(this.state.best)}</div>\n            </div>\n            <div className=\"scoreboard\">\n              <div className=\"title\">得分</div>\n              <div>{getNumber(this.state.score)}</div>\n              {this.state.scoreAdded > 0 &&\n              <div className=\"added\">\n                +{this.state.scoreAdded}\n              </div>\n              }\n            </div>\n            <h1 className={this.state.logoPulse ? 'logo-pulse' : undefined} aria-label=\"鸡你太美\">\n              你太美\n            </h1>\n          </header>\n          <section className=\"actions\">\n            <div className=\"new-game-wrapper\">\n              <button className=\"new-game\" onClick={this._newGame}>新游戏</button>\n            </div>\n            <div className=\"hint\">移动、合并相同方块。目标是: <strong>篮球</strong> !</div>\n          </section>\n          <section className={`game${this.state.messageVisible ? ' has-message' : ''}`}>\n            <div className=\"game-container\" ref={this.containerRef}>{\n              [0, 1, 2, 3].map(i => [0, 1, 2, 3].map(j =>\n                <span className={`game-cell pos-i-${i} pos-j-${j}`} key={`${i}-${j}`} />,\n              ))\n            }{\n              this.state.tiles.map(({ i, j, value, key, overlaid }) =>\n                <Tile i={i} j={j} value={value} key={key} overlaid={overlaid} />,\n              )\n            }</div>\n            {\n              this.state.message === 'start' &&\n              <div className=\"game-message\" role=\"button\" aria-label=\"隐藏消息\" onClick={this._newGame}>\n                <div className=\"start\" role=\"img\" aria-label=\"耳机\" />\n                <h2>开始游戏!</h2>\n                <p>点按以开始<br /><small>[请勿在公共场合外放]</small></p>\n              </div>\n            }{\n            this.state.message === 'win' &&\n            <div className=\"game-message\" role=\"button\" aria-label=\"隐藏消息\" onClick={() => this.setState({\n              messageVisible: false,\n            })}>\n              <div className=\"win\" role=\"img\" aria-label=\"篮球\" />\n              <h2>恭喜你成功了!</h2>\n              <p>点按以继续</p>\n            </div>\n          }{\n            this.state.message === 'win-game-over' &&\n            <div className=\"game-message\" role=\"button\" aria-label=\"隐藏消息\" onClick={() => this.setState({\n              messageVisible: false,\n            })}>\n              <div className=\"win\" role=\"img\" aria-label=\"篮球\" />\n              <h2>你成功了!</h2>\n              <p>点按以隐藏提示<br /><small>[游戏结束]</small></p>\n            </div>\n          }{\n            this.state.message === 'game-over' &&\n            <div className=\"game-message\" role=\"button\" aria-label=\"隐藏消息\" onClick={() => this.setState({\n              messageVisible: false,\n            })}>\n              <div className=\"game-over\" role=\"img\" aria-label=\"菜\" />\n              <h2>游戏结束!</h2>\n              <p>点按以隐藏提示</p>\n            </div>\n          }</section>\n          <section className=\"introduction\">\n            <div className=\"how-to\">\n              玩法：<strong>{'ontouchstart' in window ? '用手指滑动' : '按 方向键 或 WASD 键'}</strong> 来移动方块，<br />两个相同的方块可以合成新方块。<br />\n              <span className=\"about-arrow\">关于</span>\n            </div>\n          </section>\n        </div>\n        <div className=\"about\">\n          <section className=\"introduction\">\n            <p>\n              游戏中加入了特别的文字和音效，出自年轻人喜闻乐见的个人练习生。\n              <a href=\"https://play2048.co/\" target=\"_blank\" rel=\"noopener noreferrer\">原始版本的 2048</a> 游戏作者 <a\n              href=\"https://gabrielecirulli.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Gabriele\n              Cirulli</a> ，此项目的游戏方式和样式均来自此处。\n            </p>\n            <p>\n              如果觉得好玩，不妨点一下 Follow 和 Star ～\n            </p>\n            <p className=\"small\">\n              此项目为 Qt 项目 <a href=\"https://github.com/ZKLlab/cxk-2048-cpp\" target=\"_blank\"\n                            rel=\"noopener noreferrer\">2018-2019 学年夏季学期《计算机编程实训》第 17 组作业</a> 的原型，最初用 Vue.js 编写，当前为\n              React + TypeScript 重写版本，加入了移动端支持、最高分、游戏状态保存以及一些特效。\n            </p>\n            <p className=\"social-buttons\">\n              <GitHubButton href=\"https://github.com/ZKLlab\" data-size=\"large\" data-show-count={true}\n                            aria-label=\"Follow @ZKLlab on GitHub\">Follow @ZKLlab</GitHubButton>\n              <GitHubButton href=\"https://github.com/ZKLlab/cxk-2048-react\" data-icon=\"octicon-star\" data-size=\"large\"\n                            data-show-count={true} aria-label=\"Star ZKLlab/cxk-2048-react on GitHub\">Star</GitHubButton>\n            </p>\n            <p className=\"view-on-github\">\n              <a href=\"https://github.com/ZKLlab/cxk-2048-react\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <svg viewBox=\"0 0 16 16\" className=\"github-icon\" aria-hidden=\"true\">\n                  <path\n                    d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z\" />\n                </svg>\n                View on Github</a>\n            </p>\n            <div className=\"copyright\">\n              Copyright &copy; {new Date().getFullYear()} <a href=\"https://github.com/ZKLlab\" target=\"_blank\"\n                                                             rel=\"noopener noreferrer\">ZKLlab</a>\n            </div>\n          </section>\n        </div>\n      </React.Fragment>\n    );\n  }\n\n  protected _newGame = (event?: React.MouseEvent<HTMLElement>) => {\n    if (event != null) {\n      event.currentTarget.blur();\n    }\n    setTimeout(() => {\n      if (this.soundManager != null) {\n        this.soundManager.play(2);\n        this._createGame();\n      }\n    }, this.state.messageVisible ? 250 : 50);\n    this.setState({\n      score: 0,\n      messageVisible: false,\n    });\n    // @ts-ignore\n    window.gtag('event', 'new_game');\n  };\n\n  protected _tryResumeGame = () => {\n    const { best, score, game } = this.stateManager.getState();\n    this.setState(Object.assign({\n      best,\n      score,\n    }, game != null ? {\n      messageVisible: false,\n    } : {}));\n    if (game != null) {\n      // @ts-ignore\n      window.gtag('event', 'resume_game', {\n        score: score,\n        best: best,\n      });\n      this._createGame(game);\n    }\n  };\n\n  protected _createGame = (state: number[] | null = null) => {\n    let firstUpdate = true;\n    this.game = new Game2048({\n      onUpdate: tiles => {\n        this.setState({ tiles });\n        if (!firstUpdate || state == null) {\n          this.vibratorManager.vibrateShort(1);\n        }\n        firstUpdate = false;\n      },\n      onScoreAdd: value => {\n        this.setState({\n          score: this.state.score + value,\n          scoreAdded: 0,\n          best: Math.max(this.state.score + value, this.state.best),\n        }, () => setTimeout(() => this.setState({\n          scoreAdded: value,\n        }), 50));\n      },\n      onMaxMerge: value => {\n        if (this.soundManager != null) {\n          this.soundManager.play(value);\n          this.vibratorManager.vibrateShort(2);\n        }\n      },\n      on2048: gameOver => {\n        this.vibratorManager.vibrateLong();\n        this.setState({\n          messageVisible: true,\n          message: gameOver ? 'win-game-over' : 'win',\n        });\n        // @ts-ignore\n        window.gtag('event', 'win');\n        if (gameOver) {\n          // @ts-ignore\n          window.gtag('event', 'game_over', {\n            score: this.state.score,\n            best: this.state.best,\n          });\n        }\n      },\n      onGameOver: () => {\n        this.vibratorManager.vibrateLong();\n        this.setState({\n          messageVisible: true,\n          message: 'game-over',\n        });\n        // @ts-ignore\n        window.gtag('event', 'game_over', {\n          score: this.state.score,\n          best: this.state.best,\n        });\n      },\n      onStateChanged: newState => {\n        this.stateManager.setState({\n          best: this.state.best,\n          score: newState != null ? this.state.score : 0,\n          game: newState,\n        });\n      },\n      state,\n    });\n  };\n\n  protected _moveK = (event: KeyboardEvent) => {\n    if (this.game != null && !this.state.messageVisible && !event.ctrlKey && !event.altKey && !event.metaKey) {\n      const game: Game2048 = this.game;\n      const key = event.key.toLowerCase();\n      let flag = true;\n      if (key === 'arrowup' || key === 'w') {\n        game.move(Direction.Up);\n      } else if (key === 'arrowright' || key === 'd') {\n        game.move(Direction.Right);\n      } else if (key === 'arrowdown' || key === 's') {\n        game.move(Direction.Down);\n      } else if (key === 'arrowleft' || key === 'a') {\n        game.move(Direction.Left);\n      } else {\n        flag = false;\n      }\n      if (flag) {\n        event.preventDefault();\n      }\n    } else if (this.state.messageVisible) {\n      const key = event.key.toLowerCase();\n      if (key === ' ' || key === 'enter') {\n        const gameMessage: HTMLDivElement | null = document.querySelector('div.game-message');\n        if (gameMessage != null) {\n          gameMessage.click();\n          event.preventDefault();\n        }\n      }\n    }\n  };\n\n  protected _moveG = (direction: number) => {\n    if (this.game != null && !this.state.messageVisible) {\n      if (direction === Hammer.DIRECTION_UP) {\n        this.game.move(Direction.Up);\n      } else if (direction === Hammer.DIRECTION_RIGHT) {\n        this.game.move(Direction.Right);\n      } else if (direction === Hammer.DIRECTION_DOWN) {\n        this.game.move(Direction.Down);\n      } else if (direction === Hammer.DIRECTION_LEFT) {\n        this.game.move(Direction.Left);\n      }\n    }\n  };\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n  ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href,\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: {'Service-Worker': 'script'},\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.scss';\nimport * as serviceWorker from './serviceWorker';\n\n\nfunction setDocHeight() {\n  document.documentElement.style.setProperty('--vh', `${window.innerHeight / 100}px`);\n}\n\n// @ts-ignore\nwindow.gtag = window.gtag || (() => undefined);\n\nwindow.addEventListener('resize', setDocHeight);\nwindow.addEventListener('orientationchange', setDocHeight);\nsetDocHeight();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n\nserviceWorker.register();\n"],"sourceRoot":""}